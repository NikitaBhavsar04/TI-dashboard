[supervisord]
nodaemon=true

[program:web]
command=npm start
directory=/app
environment=NODE_ENV="production"
stdout_logfile=/dev/fd/1
stdout_logfile_maxbytes=0
stderr_logfile=/dev/fd/2
stderr_logfile_maxbytes=0
autorestart=true
startretries=3

[program:worker]
; Worker runs generate_advisories periodically if ENABLE_WORKER=1
command=bash -lc 'if [ "${ENABLE_WORKER:-0}" = "1" ]; then while true; do python /app/backend/generate_advisories.py 3 || true; sleep 3600; done; else tail -f /dev/null; fi'
directory=/app
stdout_logfile=/dev/fd/1
stdout_logfile_maxbytes=0
stderr_logfile=/dev/fd/2
stderr_logfile_maxbytes=0
autorestart=true
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <title>{{ title or 'Advisory' }}</title>
  <style>
    /* Layout and typography */
    :root{ --max-width:1200px; --accent-1:#04033b; --accent-2:#05849b; --accent-3:#2C71C3; }
    html,body{height:100%;}
    body{font-family:Arial, sans-serif;margin:0;padding:0;background:#f4f4f4;color:#0b2233;}
    .container{width:100%;max-width:var(--max-width);margin:0 auto;padding:20px;box-sizing:border-box}

    /* Hero */
    .blue-box{position:relative;margin:50px auto;background-size:cover;background-repeat:no-repeat;background-position:center;border-radius:8px;padding:15px;box-shadow:2px 2px 10px rgba(146,17,17,0.2);font-weight:bold}
    .blue-inner{display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap}
    .blue-box .logo{width:160px;max-width:22%;height:auto;margin:10px}
    .blue-box .hero-title{flex:1;text-align:center;color:#fff;font-size:30px}
    .threat-criticality{width:100%;padding:0 15px;box-sizing:border-box;display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:10px}

    /* TLP and summary */
    .styled-box{background:rgba(0,0,0,0.6);padding:5px 10px;height:auto;border-radius:10px;display:inline-block}
    .tlp-selector span{display:inline-block;width:30px;height:30px;border-radius:50%;border:2px solid black;margin-right:6px}

    /* Sections */
    .section-wrap{padding:20px 30px}
    .gradient-line{height:6px;width:28%;background:linear-gradient(to right, rgb(20, 9, 182), rgb(219, 114, 15), blue);border-radius:2px;margin-bottom:10px}
    h2{color:#000;font-size:22px;margin-bottom:8px}
    p{color:#000;line-height:1.6}

    /* Info cards and tables */
    .info-cards{display:flex;gap:12px;flex-wrap:wrap}
    .info-card{flex:1;min-width:180px;padding:15px;border-radius:10px;background:linear-gradient(135deg,var(--accent-1),var(--accent-2),var(--accent-1));color:#fff;box-shadow:0 4px 10px rgba(0,0,0,0.1)}
    .mitre-table{width:100%;border-collapse:collapse;margin-top:20px;margin-bottom:20px;background-color:rgb(2,80,104);color:white;font-weight:bold}
    .mitre-table th,.mitre-table td{border:2px solid #000;padding:8px}

    /* Recommendations / references */
    .panel{background:linear-gradient(135deg,var(--accent-1),var(--accent-2),var(--accent-1));padding:20px;border-radius:10px;color:#fff;margin-bottom:20px}
    .panel ul{list-style:none;padding:0;margin:0}

    /* Responsive tweaks */
    @media (max-width:900px){
      :root{--max-width:900px}
      .blue-box .logo{width:120px}
      .hero-title{font-size:22px}
      .gradient-line{width:40%}
      h2{font-size:20px}
    }
    @media (max-width:600px){
      :root{--max-width:100%}
      .container{padding:10px}
      .blue-box{margin:20px 10px}
      .blue-inner{flex-direction:column;align-items:center}
      .blue-box .logo{width:80px;margin:8px}
      .hero-title{font-size:18px}
      .threat-criticality{justify-content:center;text-align:center}
      .gradient-line{width:100%}
      .mitre-table{font-size:14px}
      .info-cards{flex-direction:column}
    }
    @media (min-width:1600px){
      :root{--max-width:1500px}
      .blue-box .logo{width:180px}
    }
  /* Ensure criticality and threat type are always white for visibility */
  .Criticality-box, .threat-box, .Criticality-box p, .threat-box p { color: #ffffff !important; }
  </style>
  </head>
<body style="font-family: 'Arial', sans-serif; margin: 0; padding: 0; background-color: #f4f4f4;">
     
  <div class="blue-box" style="position: relative; width: 100%;margin-top:50px; background-image: url('https://www.shutterstock.com/image-vector/big-data-abstract-digital-futuristic-600nw-2413052803.jpg'); min-height: 100px; background-size: cover; background-repeat: no-repeat; background-position: center; font-weight: bold; padding: 15px; border-radius: 8px; text-align: center; margin: auto; box-shadow: 2px 2px 10px rgba(146, 17, 17, 0.2); font-size: 30px;">
    <div class="blue-inner">
      <img src="https://forensiccybertech.com/wp-content/uploads/2025/09/cybertech-logo.webp" alt="Threat Logo" class="logo" style="width: 160px; height: auto; max-height: 160px; display: block; margin: 10px;">
      <div class="hero-title">
    {% set _words = (title or 'Advisory').split() %}
    {% set stopwords = ['with','and','or','in','for','of','to','by','on','at','from','about','into','over','after','before','between','under'] %}
    {% if _words|length <= 6 %}
      {% set _short = _words %}
    {% else %}
      {% set _short = _words[:6] %}
      {% if _short[-1]|lower in stopwords %}
        {# prefer extending by one word if available and that doesn't end on a stopword #}
        {% if _words|length > 6 and (_words[6]|lower not in stopwords) %}
          {% set _short = _words[:7] %}
        {% else %}
          {# otherwise fallback to 5 words to avoid trailing connectors #}
          {% set _short = _words[:5] %}
        {% endif %}
      {% endif %}
    {% endif %}
  <h1 style="margin:0;color:#fff;font-size:34px;line-height:1.1" title="{{ full_title or title }}">{{ _short|join(' ') }}{% if _words|length > _short|length %}...{% endif %}</h1>
      </div>
      <img src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiCL2GuXkm4vnkAnNz1yA4Kxlg-jjKIOdohivr_s_uCRQ5z1gYjlSJX139c7I-iR-2i3sCVQK3kmP3_ZRvvBezy_m5eB-sX9N3cn42lJbi5PveE90jfqPt4Luc52J6nU1MTIWZGkdBzT76fTVru6Wk8RafSOcgNzPumjNLay5fUxQ_YIihCHQ7Us1_-wVMV/s400/Eagleye-S.png" alt="Threat Logo" class="logo" style="width: 160px; height: auto; max-height: 160px; display: block; margin: 10px;">
    </div>
    <div class="threat-criticality" style="width: 100%; padding: 0 15px; position: relative; overflow: hidden;">
      <div class="Criticality-box" style="font-weight: bold; color: white; text-align: right; font-size: 25px; float: left; padding-top: 0px;">
        <p><strong>Criticality:</strong> {{ criticality }}</p>
      </div>
            
      <div class="threat-box" style="font-size: 25px; font-weight: bold; color: white; text-align: right; max-width: 95%; float: right; margin-right: 45px; ">
        <p><strong>Threat Type:</strong> {{ threat_type }}</p>
      </div>
    </div> 
  </div>
    
  <div style="padding: 20px 30px; text-align: left;">
    <div class="tlp-section" style="margin-top: 10px; margin-bottom: 10px;">
      <p class="styled-box" style="background-color: rgba(0, 0, 0, 0.6); margin: auto; padding: 5px 10px; height: 30px; border: 2px solid 10px; width: 150px; justify-content: center; border-radius: 10px; display: inline-block; vertical-align: middle;">
        <a style="color: white; font-size: 25px;"><strong>TLP:</strong><a style="color: white; font-weight: bold; font-size: 25px;">{{ tlp }}</a></a>
      </p>
      <div class="tlp-selector" style="margin: 10px 0 0 0; text-align: left; width: 100%; display: flex; justify-content: flex-start;">
          <span style="display: inline-block; width: 30px; height: 30px; border-radius: 50%; border: 2px solid black; background-color: white;"></span>
          <span style="display: inline-block; width: 30px; height: 30px; border-radius: 50%; border: 2px solid black; background-color: #FFC000"></span>
          <span style="display: inline-block; width: 30px; height: 30px; border-radius: 50%; border: 2px solid black; background-color: white;"></span>
        </div>
      </div>
    </div>
      <input type="hidden" id="advisory-id" value="{{ advisory_id }}">

    <div class="gradient-line" style="height: 6px; width: 28%; background: linear-gradient(to right, rgb(20, 9, 182), rgb(219, 114, 15), blue); border-radius: 2px; margin-bottom: 10px;"></div>
  <h2 style="color: #000000; font-size: 25px; margin-bottom: 1px; text-decoration: underline;">Executive Summary: </h2>
  <p style="color: #000000; line-height: 1.8; font-size: 20px; margin-bottom: 20px;">{{ exec_summary }}</p>
        
    <table style="width: 100%; border-spacing: 10px; text-align: center;">
      <tr>
        <td style="background: linear-gradient(135deg, #04033b, #05849b, #04033b); padding: 15px; border-radius: 10px; box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.1);">
          <h3 style="color: white; font-size: 22px; margin-bottom: 10px; text-decoration: underline;">Affected Product:</h3>
                    <p style="color: white; font-size: 18px;">{{ product }}</p>
        </td>
        <td style="background: linear-gradient(135deg, #04033b, #05849b, #04033b); padding: 15px; border-radius: 10px; box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.1);">
          <h3 style="color: white; font-size: 22px; margin-bottom: 10px; text-decoration: underline;">Target Sector:</h3>
                    <p style="color: white; font-size: 18px;">{{ sectors|join(', ') }}</p>
        </td>
        <td style="background: linear-gradient(135deg, #04033b, #05849b, #04033b); padding: 15px; border-radius: 10px; box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.1);">
          <h3 style="color: white; font-size: 22px; margin-bottom: 10px; text-decoration: underline;">Region:</h3>
                    <p style="color: white; font-size: 18px;">{{ regions|join(', ') }}</p>
        </td>
      </tr>
    </table>
        
    <div class="gradient-line" style="height: 6px; width: 28%; background: linear-gradient(to right, rgb(20, 9, 182), rgb(219, 114, 15), blue); border-radius: 2px; margin-bottom: 10px;"></div>
    <h2 style="color: #000000; font-size: 25px; margin-bottom: 1px; text-decoration: underline;">Technical Details: </h2>
    <p style="color: black; line-height: 1.8; font-size: 16px; margin-bottom: 20px;"> 
      <span style= "font-size:15px; margin-bottom: 1px;"><span style="display: block; padding-left: 20px;font-size:18px; position: relative; margin-top:10px; margin-bottom: 5px;">
                <span style="position: absolute; left: 0; color: rgb(0, 0, 0); font-weight: bold;">•</span><strong>CVE:</strong> {{ cves|join(', ') }}</span>

      <p><span style="font-size:15px; margin-top:1px;"><span style="display: block; padding-left: 20px;font-size:20px; position: relative; margin-top:10px; margin-bottom: 5px;">
        <span style="position: absolute; left: 0; color: rgb(0, 0, 0); font-weight: bold;">•</span><strong>THREAT PROFILE:</strong></span> </span> </span> <span style="font-size:18;">
        <h3 style="color:white; margin-top:10px; margin-bottom:6px;">THREAT PROFILE</h3>
        <table style="width: 100%; border: 2px solid #000; border-collapse: collapse; margin-top: 10px; margin-bottom: 20px; background-color:rgb(2, 80, 104); color:white; font-weight: bold;">
          <tr>
            <th style="border: 1px solid black;border: 2px solid #000; padding: 8px;background-color:rgb(31, 32, 112); color:white; font-weight: bold">TACTIC</th>
            <th style="border: 1px solid black; padding: 8px;border: 2px solid black;background-color:rgb(13, 15, 90); color:white; font-weight: bold">TECHNIQUE ID</th>
            <th style="border: 1px solid black; padding: 8px;border: 2px solid #000;background-color:rgb(31, 32, 112); color:white; font-weight: bold">TECHNIQUE</th>
          </tr>
          {% if mitre %}
            {% for row in mitre %}
            <tr>
              <td style="border: 1px solid black;border: 2px solid #000; padding: 8px;">{{ row.tactic or row.tacticName or row.name or 'N/A' }}</td>
              <td style="border: 1px solid black; padding: 8px;border: 2px solid #000;">{{ row.id or row.techniqueId or row.technique_id or 'N/A' }}</td>
              <td style="border: 1px solid black; padding: 8px;border: 2px solid #000;">{{ row.technique or (row.techniques[0] if row.techniques else '') or 'N/A' }}</td>
            </tr>
            {% endfor %}
          {% else %}
            <tr>
              <td style="border: 1px solid black;border: 2px solid #000; padding: 8px;">No mapping available</td>
              <td style="border: 1px solid black; padding: 8px;border: 2px solid #000;">N/A</td>
              <td style="border: 1px solid black; padding: 8px;border: 2px solid #000;">N/A</td>
            </tr>
          {% endif %}
        </table>
      </div>
    </p>

        

    <div style="background:linear-gradient(135deg, #04033b, #05849b, #04033b); padding: 20px; border-radius: 10px; box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.1); margin-bottom: 20px;">
      <h3 style="color: white; font-size: 22px; margin-bottom: 10px; margin-top: 1px;text-decoration: underline;">Recommendations:</h3>
      <ul style="list-style: none; padding: 0;">
        {% for rec in recommendations %}
        <li style="margin-bottom: 10px; font-size: 20px; color: white;"><span style="color: #2C71C3; font-weight: bold; margin-right: 10px;">✔</span> {{ rec }}</li>
        {% endfor %}
      </ul>
    </div>
    <div style="background:linear-gradient(135deg, #04033b, #05849b, #04033b); padding: 20px; border-radius: 10px; box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.1); margin-bottom: 20px;">
      <h3 style="color: white; font-size: 22px; margin-bottom: 10px;text-decoration: underline;">References:</h3>
      <ul style="list-style: none; padding: 0;">
        {% for ref in references %}
        <li style="margin-bottom: 10px; font-size: 16px; color: white;"><span style="color: #2C71C3; font-weight: bold; margin-right: 10px;">✔</span><a href="{{ ref }}" style="font-size:20px; color:white; margin-bottom:5px;">{{ ref }}</a></li>
        {% endfor %}
      </ul> 
      <h3 style="color: white; font-size: 22px; margin-bottom: 10px;text-decoration: underline;">Patch Details:</h3>
      <ul style="list-style: none; padding: 0;">
        {% if patch_details %}
          {% for p in patch_details %}
          <li style="margin-bottom: 10px; font-size: 20px; color: white;"><span style="color: #2C71C3; font-weight: bold; margin-right: 10px;">✔</span> {{ p }}</li>
          {% endfor %}
        {% else %}
          <li style="margin-bottom: 10px; font-size: 20px; color: white;"><span style="color: #2C71C3; font-weight: bold; margin-right: 10px;">✔</span> No patch details provided.</li>
        {% endif %}
      </ul>
    </div>
  </div>
</div>

</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>{{ title or 'Advisory' }}</title>

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&family=Rajdhani:wght@500;600;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --max-width: auto;

      /* Core brand / trust colors */
      --primary-dark: #0B1F33;
      --primary:      #1F3A5F;
      --secondary:    #1FA4B8;

      /* Accent / highlight */
      --accent:       #2C71C3;

      /* Status / severity */
      --severity-low:    #2E7D32;
      --severity-medium: #F9A825;
      --severity-high:   #C62828;

      /* Neutrals */
      --bg-light:   #F5F7FA;
      --bg-white:   #FFFFFF;
      --text-dark:  #0B2233;
      --text-muted: #5F6C7B;
      --border:     #D7DEE8;

      --font-body: 'Roboto', Arial, sans-serif;
      --font-heading: 'Rajdhani', Arial, sans-serif;

      --radius: 12px;
      --shadow: 0 10px 28px rgba(11,31,51,.12);
    }

    * { box-sizing: border-box; }
    html, body { height: 100%; margin: 0; padding: 0; }

    body{
      font-family: var(--font-body);
      background: var(--bg-light);
      color: var(--text-dark);
      line-height: 1.65;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    a{ color: var(--accent); text-decoration: none; }
    a:hover{ text-decoration: underline; }

    .container{
      width: 100%;
      max-width: var(--max-width);
      margin: 0 auto;
      padding: 20px;
    }

    /* Hero */
    .hero{
      position: relative;
      border-radius: var(--radius);
      background-image: url("head_bg.png");
      overflow: hidden;
      box-shadow: var(--shadow);
      background: linear-gradient(135deg, var(--primary-dark), var(--primary));
      color: #fff;
    }

    .hero::before{
  content:'';
  position:absolute;
  inset:0;
  background: url("head_bg.png") center/cover no-repeat;
  filter: blur(0.5px);
  opacity: 1;   /* increase this */
  z-index: 0;
}

.hero::after{
  content:'';
  position:absolute;
  inset:0;
  background: linear-gradient(
    135deg,
    rgba(11,31,51,.72),  /* reduce this */
    rgba(31,58,95,.68)   /* reduce this */
  );
  z-index: 1;
}

.hero > *{
  position: relative;
  z-index: 2;
}


    .hero-top{
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 14px;
      padding: 16px 18px 8px 18px;
      flex-wrap: wrap;
    }

    .hero-logo{
      width: 160px;
      max-width: 28%;
      height: auto;
      display: block;
    }

    .hero-title{
      flex: 1;
      min-width: 220px;
      text-align: center;
    }

    .hero-title h1{
      margin: 0;
      color: #fff;
      font-family: var(--font-heading);
      font-weight: 700;
      letter-spacing: .3px;
      line-height: 1.1;
      font-size: 34px;
      text-wrap: balance;
    }

    .hero-meta{
  display: flex;
  gap: 12px;
  flex-wrap: wrap;
  align-items: center;
  justify-content: space-between; /* or flex-start */
  padding: 8px 18px 18px 18px;
}

.meta-chip{
  flex: 0 0 auto;          /* key: do not grow full width */
  display: inline-flex;     /* makes it behave like a “button” */
  flex-direction: column;
  min-width: unset;         /* remove your min-width: 240px */
  max-width: 360px;         /* optional safety */
  padding: 10px 14px;
  border-radius: 10px;
  background: rgba(255,255,255,.08);
  border: 1px solid rgba(255,255,255,.18);
  backdrop-filter: blur(6px);
}


    .meta-chip .label{
      display: block;
      font-family: var(--font-heading);
      font-weight: 700;
      opacity: .95;
      font-size: 14px;
      letter-spacing: .4px;
      text-transform: uppercase;
      margin-bottom: 3px;
    }

    .meta-chip .value{
      display: block;
      font-family: var(--font-heading);
      font-weight: 600;
      font-size: 20px;
      color: #fff;
    }

    /* Severity as semantic (badge next to criticality value if you want) */
    .severity-badge{
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 4px 10px;
      border-radius: 999px;
      font-size: 14px;
      font-weight: 700;
      font-family: var(--font-heading);
      border: 1px solid rgba(255,255,255,.2);
    }
    .sev-low{ background: rgba(46,125,50,.25); }
    .sev-med{ background: rgba(249,168,37,.25); color: #fff; }
    .sev-high{ background: rgba(198,40,40,.25); }

    /* Content shell */
    .content{
      padding: 18px;
    }

    .section{
      background: var(--bg-white);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: 0 6px 18px rgba(11,31,51,.06);
      padding: 18px;
      margin: 14px 0;
    }

    .section-head{
      display: flex;
      align-items: center;
      gap: 10px;
      margin: 0 0 10px 0;
    }

    .section-line{
      height: 6px;
      width: 60px;
      border-radius: 999px;
      background: linear-gradient(to right, var(--secondary), var(--accent));
      flex: 0 0 auto;
    }

    h2{
      margin: 0;
      font-family: var(--font-heading);
      font-size: 24px;
      font-weight: 700;
      color: var(--primary-dark);
    }

    h3{
      margin: 0 0 10px 0;
      font-family: var(--font-heading);
      font-size: 20px;
      font-weight: 700;
      color: var(--primary-dark);
    }

    p{
      margin: 0 0 10px 0;
      color: var(--text-dark);
      font-size: 16px;
    }

    .muted{ color: var(--text-muted); }

    /* TLP block */
    .tlp{
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: 12px;
      justify-content: space-between;
      margin-top: 14px;
    }

    .tlp-label{
      display: inline-flex;
      align-items: center;
      gap: 10px;
      padding: 10px 12px;
      border-radius: 10px;
      background: var(--primary-dark);
      color: #fff;
      border: 1px solid rgba(255,255,255,.12);
      font-family: var(--font-heading);
      font-weight: 800;
      letter-spacing: .4px;
    }

    .tlp-dots{
      display: inline-flex;
      gap: 8px;
      align-items: center;
      flex-wrap: wrap;
    }

    .tlp-dot{
      width: 18px; height: 18px;
      border-radius: 50%;
      border: 1px solid #999;
      background: transparent;
    }

    .tlp-clear.active{ background: #FFFFFF; }
    .tlp-green.active{ background: var(--severity-low); }
    .tlp-amber.active{ background: var(--severity-medium); }
    .tlp-red.active{ background: var(--severity-high); }

    /* Key info table (Product/Sector/Region) */
    .kpi-grid{
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 12px;
      margin-top: 12px;
    }

    .kpi{
      border-radius: 12px;
      padding: 14px;
      background: linear-gradient(135deg, var(--primary-dark), var(--primary));
      color: #fff;
      border: 1px solid rgba(255,255,255,.10);
    }

    .kpi .kpi-title{
      font-family: var(--font-heading);
      font-weight: 800;
      font-size: 16px;
      margin: 0 0 6px 0;
      color: #fff;
      letter-spacing: .2px;
      text-transform: none;
    }

    .kpi .kpi-value{
      margin: 0;
      color: rgba(255,255,255,.92);
      font-size: 15px;
      word-break: break-word;
    }

    /* Threat profile table */
    .table-wrap{
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
      border-radius: 12px;
      border: 1px solid var(--border);
    }

    table{
      width: 100%;
      border-collapse: collapse;
      background: #fff;
      min-width: 640px;
    }

    th, td{
      padding: 10px 10px;
      border-bottom: 1px solid var(--border);
      text-align: left;
      vertical-align: top;
      font-size: 14px;
    }

    th{
      background: #0E2742;
      color: #fff;
      font-family: var(--font-heading);
      font-size: 15px;
      letter-spacing: .3px;
    }

    tr:nth-child(even) td{ background: #F7FAFD; }

    /* Panels for lists */
    .panel{
      border-radius: var(--radius);
      background: linear-gradient(135deg, var(--primary-dark), var(--primary));
      color: #fff;
      padding: 16px;
      margin-top: 12px;
    }

    .panel h3{
      color: #fff;
      margin: 0 0 10px 0;
    }

    .panel ul{
      margin: 0;
      padding: 0;
      list-style: none;
    }

    .panel li{
      margin: 0 0 10px 0;
      display: flex;
      gap: 10px;
      align-items: flex-start;
      font-size: 16px;
      color: rgba(255,255,255,.92);
    }

    .check{
      color: var(--secondary);
      font-weight: 900;
      line-height: 1.2;
      margin-top: 1px;
      flex: 0 0 auto;
    }

    /* Footer spacing */
    .spacer{ height: 6px; }

    /* Responsive */
    @media (max-width: 900px){
      :root{ --max-width: 900px; }
      .hero-title h1{ font-size: 24px; }
      .hero-logo{ width: 120px; }
      .kpi-grid{ grid-template-columns: 1fr; }
      table{ min-width: 520px; }
    }

    @media (max-width: 600px){
      .container{ padding: 10px; }
      .hero-top{ justify-content: center; }
      .hero-title{ text-align: center; }
      .hero-logo{ width: 90px; max-width: 40%; }
      .meta-chip{ min-width: 100%; }
      .content{ padding: 10px; }
      h2{ font-size: 20px; }
    }
  </style>
</head>

<body>
  <div class="container">
    <!-- HERO -->
    <header class="hero" role="banner" aria-label="Cyber advisory header">
      <div class="hero-top">
        <img
          src="https://eagleyesoc-logos.s3.us-east-1.amazonaws.com/clients/FCTlogo.webp"
          alt="Organization logo"
          class="hero-logo"
        />

        <div class="hero-title">
          {% set _words = (title or 'Advisory').split() %}
          {% set stopwords = ['with','and','or','in','for','of','to','by','on','at','from','about','into','over','after','before','between','under'] %}
          {% if _words|length <= 6 %}
            {% set _short = _words %}
          {% else %}
            {% set _short = _words[:6] %}
            {% if _short[-1]|lower in stopwords %}
              {% if _words|length > 6 and (_words[6]|lower not in stopwords) %}
                {% set _short = _words[:7] %}
              {% else %}
                {% set _short = _words[:5] %}
              {% endif %}
            {% endif %}
          {% endif %}
          <h1 title="{{ full_title or title }}">
            {{ _short|join(' ') }}{% if _words|length > _short|length %}...{% endif %}
          </h1>
        </div>

        <img
          src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiCL2GuXkm4vnkAnNz1yA4Kxlg-jjKIOdohivr_s_uCRQ5z1gYjlSJX139c7I-iR-2i3sCVQK3kmP3_ZRvvBezy_m5eB-sX9N3cn42lJbi5PveE90jfqPt4Luc52J6nU1MTIWZGkdBzT76fTVru6Wk8RafSOcgNzPumjNLay5fUxQ_YIihCHQ7Us1_-wVMV/s400/Eagleye-S.png"
          alt="Partner logo"
          class="hero-logo"
        />
      </div>

      <div class="hero-meta">
        <div class="meta-chip">
          <span class="label">Criticality</span>
          <span class="value">
            {{ criticality }}
          </span>
        </div>

        <div class="meta-chip">
          <span class="label">Threat type</span>
          <span class="value">{{ threat_type }}</span>
        </div>
      </div>
    </header>

    <!-- TLP + hidden advisory id -->
    <div class="tlp" aria-label="TLP marking">
      <div class="tlp-label">TLP:{{ tlp }}<div class="tlp-dots" aria-hidden="true" title="TLP indicator">
        <span class="tlp-dot tlp-clear {% if tlp == 'CLEAR' %}active{% endif %}"></span>
        <span class="tlp-dot tlp-green {% if tlp == 'GREEN' %}active{% endif %}"></span>
        <span class="tlp-dot tlp-amber {% if tlp in ['AMBER','AMBER+STRICT'] %}active{% endif %}"></span>
        <span class="tlp-dot tlp-red {% if tlp == 'RED' %}active{% endif %}"></span>
      </div></div>

      
    </div>

    <input type="hidden" id="advisory-id" value="{{ advisory_id }}">

    <!-- CONTENT -->
    <main class="content" role="main">
      <!-- Executive Summary -->
      <section class="section" aria-label="Executive Summary">
        <div class="section-head">
          <div class="section-line"></div>
          <h2>Executive Summary</h2>
        </div>
        <p style="white-space: pre-line; font-size: 16px; text-align: justify;">{{ exec_summary }}</p>

        <div class="kpi-grid" aria-label="Key advisory info">
          <div class="kpi">
            <p class="kpi-title">Affected Product</p>
            <p class="kpi-value">{{ Affected_product }}</p>
          </div>

          <div class="kpi">
            <p class="kpi-title">Target Sector</p>
            <p class="kpi-value">{{ sectors|join(', ') }}</p>
          </div>

          <div class="kpi">
            <p class="kpi-title">Region</p>
            <p class="kpi-value">{{ regions|join(', ') }}</p>
          </div>
        </div>
      </section>

      <!-- Technical Details -->
      <section class="section" aria-label="Technical Details">
        <div class="section-head">
          <div class="section-line"></div>
          <h2>Technical Details</h2>
        </div>

        <p><strong>CVE:</strong> {{ cves|join(', ') }}</p>

        <div class="spacer"></div>
        <h3>Threat Profile</h3>

        <div class="table-wrap">
          <table aria-label="MITRE mapping table">
            <thead>
              <tr>
                <th>TACTIC</th>
                <th>TECHNIQUE ID</th>
                <th>TECHNIQUE</th>
              </tr>
            </thead>
            <tbody>
              {% if mitre %}
                {% for row in mitre %}
                <tr>
                  <td>{{ row.tactic or 'N/A' }}</td>
                  <td>{{ row.techniqueId or row.technique_id or 'N/A' }}</td>
                  <td>{{ row.technique or 'N/A' }}</td>
                </tr>
                {% endfor %}
              {% else %}
                <tr>
                  <td colspan="3">No mapping available</td>
                </tr>
              {% endif %}
            </tbody>
          </table>
        </div>
      </section>

      <!-- Recommendations -->
      <section class="panel" aria-label="Recommendations">
        <h3>Recommendations</h3>
        <ul>
          {% for rec in recommendations %}
            <li><span class="check">✔</span><span>{{ rec }}</span></li>
          {% endfor %}
        </ul>
      </section>

      <!-- References + Patch details -->
      <section class="panel" aria-label="References and Patch Details">
        <h3>References</h3>
        <ul>
          {% for ref in references %}
            <li><span class="check">✔</span><a href="{{ ref }}">{{ ref }}</a></li>
          {% endfor %}
        </ul>

        <div class="spacer"></div>

        <h3>Patch Details</h3>
        <ul>
          {% if patch_details %}
            {% for p in patch_details %}
              <li><span class="check">✔</span><span>{{ p }}</span></li>
            {% endfor %}
          {% else %}
            <li><span class="check">✔</span><span>No patch details provided.</span></li>
          {% endif %}
        </ul>
      </section>
    </main>
  </div>
</body>
</html>
